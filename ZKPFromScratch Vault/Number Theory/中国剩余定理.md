# 定理

假设我们想求满足下述方程的 $x$ ：
$$
\begin{align*}
x \equiv 2 \mod 5 \\
x \equiv 3 \mod 7
\end{align*} \tag{1}
$$
假设我们能得到一个解 $y$，那么 $y+35$ 也是一个解。所以我们只需在模 $35$ 下求解。由穷举法，找到唯一解 $x \equiv 17 \mod 35$ 。

对于任何像这样的方程组，中国剩余定理告诉我们，在一定的模数下总能找到唯一解，而且还描述了如何有效的求出这个解。

**定理**：设 $p,q$ 互质，则方程组：
$$
\begin{align*}
x \equiv a \mod p \\
x \equiv b \mod q
\end{align*} \tag{2}
$$
$x$ 在模 $pq$ 下有唯一解。

反过来则是平凡的：给定 $x \in \mathbb{Z}_{pq}$ ，我们可以直接求出 $x$ 模 $p$ 和 $x$ 模 $q$ ，从而得到上述方程组中的 $a,b$ 。

**证明**：令 $p_1=p^{-1} \mod q$ 和 $q_1=q^{-1} \mod p$  。他们必定存在，因为 $p,q$ 互质。于是我们断言如果 $y \in \mathbb{Z}$ 满足：
$$y \equiv aqq_1+bpp_1 \mod pq \tag{3}$$
则 $y$ 满足方程组 (2)，因为：

模 $p$ 时，由于 $qq_1 \equiv 1 \mod p$，所以 $y \equiv aqq_1 \equiv a \mod p$ 。类似的 $y \equiv b \mod q$。因此 $y$ 是 (1) 的一个解。

下面来证明在模 $pq$ 下没有其他解了。假设存在另一个解 $z \equiv a \mod p$ 则 $z-y$ 是 $p$ 的倍数。同时 $z \equiv b \mod q$，则 $z-y$ 也是 $q$ 的倍数。由于 $p,q$ 互质，这意味着 $z-y$ 是 $pq$ 的倍数，因此 $z \equiv y \mod pq$ 。$\blacksquare$

> 【译注】 注意 $p,q$ 互质这个条件，如果不互质，则意味着在模 $pq$ 有多个解了。

> 【译注】计算一个具体的例子就能更好理解，数学家是如何得出这个定理（算法）的。求解 (1) 时，我们希望能否分离约束，就是寻找两个整数 $x_1,x_2$，满足：
> $x_1$：除以 $5$ 余 $2$ ，除以 $7$ 余 $0$ ；
> $x_2$ ：除以 $5$ 余 $0$ ，除以 $7$ 余 $3$ 。
> 于是在 $\{0,7,14,21,...\}$ 集合中找到 $x_1=7$ 。同理，在 $\{0,5,10,15,...\}$ 集合中找到 $x_2=10$ 。把二者加在一起得到解 $x_1+x_2=17$ ，因为他们相加并不会打破约束。
> 
> 方程 (1) 还可以从更基本的方程演化而来。考虑**余数都是单位元**的情形：
> $$
\begin{align*}
x \equiv 1 \mod 5 \\
x \equiv 1 \mod 7
\end{align*}
$$> 即寻找两个整数 $y_1, y_2$，满足：
> $y_1$：除以 $5$ 余 $1$ ，除以 $7$ 余 $0$ ；
> $y_2$ ：除以 $5$ 余 $0$ ，除以 $7$ 余 $1$ 。
> 如果找到，则 $x_1=2y_1,\; x_2=3y_2$ ，方程的解为  $$x \equiv 2y_1+3y_2 \mod 35$$由于 $y_1$ 一定是 $7$ 的倍数，所以  $y_1=7k_1 \equiv 1 \mod 5$ 。由 [[模除法]] 可知，$k_1=7^{-1} \equiv 3 \mod 5$ 。同理，$y_2=5k_2 \equiv 1 \mod 7$，可得 $k_2=5^{-1} \equiv 3 \mod 7$ 。所以 $$y_1=21,\; y_2=15$$从而得到 $x=42+45 \equiv 17 \mod 35$ 。从这个计算过程可以直观的得到 (3)。

这个定理预示着我们可以用一个 $\mathbb{Z}_p$ 中的元素和一个 $\mathbb{Z}_q$ 中的元素来表达 $\mathbb{Z}_{pq}$ 中的元素，反之亦然。换句话说，我们在  $\mathbb{Z}_{pq}$ 和 $\mathbb{Z}_p \times \mathbb{Z}_q$ 之间建立了双射。

>【译注】$|\mathbb{Z}_{pq}| = |\mathbb{Z}_p \times \mathbb{Z}_q| = pq$ 。对于 $x \in \mathbb{Z}_{pq}$ 中的每一个元素，都可以通过  $x$ 模 $p$ 和 $x$ 模 $q$ 得到一个*不同的*数对 $(a,b)$ 。

**例**：我们可以把 $17 \in \mathbb{Z}_{35}$ 用 $(2,3) \in \mathbb{Z}_5 \times \mathbb{Z}_7$ 表示。我们可以把 $1 \in \mathbb{Z}_{pq}$ 用 $(1,1) \in \mathbb{Z}_p \times \mathbb{Z}_q$ 表示。

事实上，这个对应关系的作用远不止简单的标签替换。假设 $x,y \in \mathbb{Z}_{pq}$ 分别对应于 $(a,b),\; (c,d) \in \mathbb{Z}_p \times \mathbb{Z}_q$ ，稍加思考可知 $x+y$ 对应于 $(a+c, b+d)$，以及 $xy$ 对应于 $(ac,bd)$ 。

> 【译注】由中国剩余定理，$x \equiv aqq_1+bpp_1 \mod pq, \; y \equiv cqq_1+dpp_1 \mod pq$ 。对于求和 $x+y=(a+c)qq_1+(b+d)pp_1 \mod pq$ 。对其分别模 $p,q$ 得到数对 $(a+c, b+d)$。同理，对于求积 $xy \equiv acq^2{q_1}^2+bdp^2{p_1}^2+adpp_1qq_1+bcpp_1qq_1 \mod pq$ 。对其分别模 $p,q$ ，交叉项都为 $0$ ，平方项自身因为逆元而抵消，所以得到数对 $(ac, bd)$ 。

在实际应用中：如果我们需要在 $x \in \mathbb{Z}_{pq}$ 中执行很多计算 （比如 RSA 签名和解密），那么就可以将 $x$ 转化为 $(a,b) \in \mathbb{Z}_p \times \mathbb{Z}_q$ ，然后对 $(a,b)$ 进行那些计算，最后再转换回去。这样计算往往会更高效，因为对大多数算法来说，输入的大小增加一倍，运行时间就会增加一倍。

**例**：要计算 $17\times 17 \mod 35$ ，我们可以通过在 $\mathbb{Z}_5 \times \mathbb{Z}_7$ 中计算 $(2 \times 2, 3 \times 3) = (4, 2)$ ，然后再运用中国剩余定理，将数对 $(4,2)$ 还原为 $9 \mod 35$ 。

>【译注】由题意 $p=5,\; q=7, \;a=4, \;b=2$。对于 $pp_1 \equiv 1 \mod 7$，$qq_1 \equiv 1 \mod 5$ ，用穷举法可得 $p_1=3,\; q_1=3$ 。代入中国剩余定理给出的解 $y = 4 \times 7 \times 3 + 2 \times 5 \times 3 \equiv 9 \mod 35$ 。

让我们重新把中国剩余定理表述为其更常见的形式。

# 多个模方程

**定理**：令 $m_1,...,m_n$ 两两互质（即对任意 $i \ne j$ 有 $\gcd(m_i,m_j)=1$ ），则满足下述 $n$ 个方程
$$
\begin{align*}
x &\equiv a_1 \mod m_1 \\
&... \\
x &\equiv a_n \mod m_n
\end{align*} \tag{4}
$$
的解在模 $M=m_1...m_n$ 下存在且唯一。

**证明**：使用之前的定理形式可以很容易用归纳法推导出来，我们直接写出解的形式。

令 $b_i=M/m_i$ （扣除 $m_i$ 之外的所有模数之积），$b_i' = b_i^{-1} \mod m_i$ ，则能得到类似之前的结论，这个唯一解为：
$$x \equiv \sum_{i=1}^n a_i b_i b_i' \mod M$$
# 优先质数的幂

这个定理的一个重要的推论是，在研究一般的模运算之前，我们可以先研究质数幂的模运算，然后使用中国剩余定理泛化到其他情况。对于任意整数 $n$，我们都可以将其质因数分解为 $n={p_1}^{k_1}...{p_m}^{k_m}$ ，然后使用中国剩余定理得到
$$\mathbb{Z}_n=\mathbb{Z}_{{p_1}^{k_1}} \times...\times \mathbb{Z}_{{p_m}^{k_m}}$$
为了得到 $\mathbb{Z}_{p^k}$ 下的结论，可以从 $\mathbb{Z}_p$ 出发，使用归纳法逐步来到 $\mathbb{Z}_{p^k}$ 。因此真正值得研究的是 $\mathbb{Z}_p$ 。
