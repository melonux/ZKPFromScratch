假如我们要计算 $3^5 \mod 7$ ，可以先算出 $3^5=243$ 再取模 $7$ ，但更好的办法是利用 $3^4=(3^2)^2$ 。既然 $3^2=9 \equiv 2 \mod 7$ ，那么 $3^4 \equiv 2^2 \equiv 4 \mod 7$ ，最终 $$3^5=3^4 \times 3 \equiv 4 \times 3 \equiv 5 \mod 7$$第二种方法更好，因为参与运算的数值更小。

这个技巧，不断平方，使得我们可以仅在 $O(\log k)$ 模乘法的复杂度下计算出 $a^k \mod n$ 。（也可以把这个技巧用于整数域求幂，但其中的乘法没有取模，导致每次乘法所处理的位数变为约之前的两倍。）

# 离散对数问题

让我们检查模 $7$ 下，$3$ 的各次幂的结果：$$
\begin{align*}
3^1 \equiv 3 \\
3^2 \equiv 2 \\
3^3 \equiv 6 \\
3^4 \equiv 4 \\
3^5 \equiv 5 \\
3^6 \equiv 1
\end{align*}
$$注意我们是通过对前一个结果乘以 $3$ 再取模 $7$ 来计算的。除此之外，这个序列还会不断重复 （为什么？）：$$
\begin{align*}
3^7 &\equiv 3 \\
3^8 &\equiv 2 \\
&...
\end{align*}
$$乍一看，序列 $3,2,6,4,5,1$ 没有顺序或什么结构。事实上，虽然可以找到一些规律（比如跨度为 3 的两元素之和为 7 ），但事实上，我们对这个序列的性质知之甚少，以至于下面的问题很难有效解决：

（离散对数问题）令 $p$ 是质数，$g,h \in \mathbb{Z}^*_p$ 。假设 $g^x \equiv h \mod p$ ，如何求 $x$ ？

**例**：一个离散对数问题的实例：求满足 $3^x \equiv 6 \mod 7$  的 $x$ 。（答案：$x=3$ 。严格的说，任何 $x \equiv 3 \mod 6$ 都是方程的解）

回想一下，在我们第一次遇到模逆运算时，我们认为可以通过尝试每个元素来找到逆元，但这在实践中太慢了。对于离散对数也是一样：我们可以尝试每一种可能的幂，直到找到它，但这不切实际。

Eulid 算法可以快速算出模逆，但还没有快速的算法来求离散对数。目前最好的离散对数算法确实比穷举法要快，但不在多项式时间以内。

# 不可逆元素

为什么我们不关心不可逆元素的幂呢？

首先考虑 $n=p^k$ ，其中 $p$ 是某个质数。当且仅当 $\gcd(a,n)>1$ 时，$a \in \mathbb{Z}_n$ 是不可逆元素，进而意味着 $a$ 可以表示为 $a=dp$ ，其中 $d$ 为某个整数。

于是 $a^k=d^k p^k \equiv 0 \mod n$ ，因此至多 $k$ 步我们就碰到 $0$ 了。这没啥有意思的（至少在我们的目标下）。

一般的，将 $n$ 写为 $n=p^{k_1}_1...p^{k_m}_m$ 。由中国剩余定理可得 $$\mathbb{Z}_n=\mathbb{Z}_{p^{k_1}_1} \times ... \times \mathbb{Z}_{p^{k_m}_m}$$因此一个元素 $a \in \mathbb{Z}_n$ 对应于等号右侧的某个元组 $(a_1,...,a_m)$ ，并且如果有至少一个 $a_i$ 是 $p_i$ 的倍数，则 $a$ 是不可逆元素。这意味着，至多经过 $k_i$ 步，元组的第 $i$ 个成员就会成为 $0$ 。所以一般说来，对于给定的 $k$ ，每个 $a^k_i$ 要么是 0 要么是可逆元素。因此我们可以限制只研究可逆元素。

注意，此处我们再次遵从[[中国剩余定理|先前的建议]]：我们先处理质数幂的情况，然后使用中国剩余定理进行推广。
