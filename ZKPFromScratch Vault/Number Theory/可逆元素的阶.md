
[[模幂运算|离散对数问题]] 可能很难，但我们确实知道一些可逆元素 $a \in \mathbb{Z}^*_n$ 的事实。首先，在某些 $k$ 下，$a^k \equiv 1 \mod n$ ：因为既然只有有限个可逆元素，在某些 $x<y$ 时，最终必然会出现 $a^x \equiv a^y \mod n$ 。由于 $a^{-1}$ 存在，我们就能得到 $a^{y-x} \equiv 1 \mod n$ 。

设 $a \in \mathbb{Z}^*_n$ 。使得 $a^x \equiv 1 \mod n$ 的最小正整数 $x$ 称作 $a$ 的阶。一旦到达 $a^x \equiv 1 \mod n$ ，序列 $a,a^2,...$ 会开始循环。（因为 $a^{x+k} \equiv a^k \mod n$ ），而且当 $k$ 是 $x$ 的倍数时，就有 $a^k \equiv 1 \mod n$ 。

**例**：$3$ 的各次幂模 $7$ 是 $3,2,6,4,5,1$ ，所以 $3 \mod 7$ 的阶是 $6$ 。

下面的定理可以收窄可逆元素阶数的可能取值。

# 费马小定理

**定理**：令 $p$ 是质数，则 $a^p \equiv a \mod p$ 对于任意 $a \in \mathbb{Z}_p$ 成立。

这个定理经常等价的描述为 $a^{p-1} \equiv 1 \mod p, \; a>0$  。

**证明**：我们先展示一个恒等式，它有时被称为新生的幻想：对于一个质数 $p$ ，有：$$(x+y)^p \equiv x^p+y^p \mod p$$通过二项式展开可以立刻看出，因为除了两个例外， $p$ 可以整除每一项：$$(x+y)^p=x^p+y^p+p(...) \equiv x^p+y^p \mod p$$通过归纳可知：$$(x_1+...+x_n)^p \equiv x^p_1+...+x^p_n \mod p$$因此如果把 $a$ 写为 $a=1+...+1$ （有 $a$ 个 $1$ 相加），则有$$a^p=(1+...+1)^p \equiv 1^p+...+1^p=1+...+1=a \mod p \;\blacksquare$$费马小定理提供了计算 [[模除法|逆元]] 的另一种方法。对于 $a \in \mathbb{Z}^*_p$ ，$a^{-1}$ 可以通过计算 $a^{p-2}$ 来得到，因为依定理 $a \cdot a^{p-2} \equiv 1 \mod p$ 。

# 欧拉定理

**定理**：如果 $a \in \mathbb{Z}^*_n$ ，则 $a^{\phi(n)} \equiv 1 \mod n$ 。

当 $n$ 是质数时，退化为费马小定理。

**证明**：令 $m=\phi(n)$ ，并记可逆元素为 $u_1,...,u_m$ 。考虑序列 $au_1,...,au_m$ （给每个可逆元素都乘以 $a$ ）。如果 $au_i = au_j$ ，则乘以 $a^{-1}$ （因为 $a$ 是可逆元素），就会得到 $u_i = u_j$ ，因此这个序列的元素必定各不相同。更进一步，可逆元素的乘积必定也是可逆元素，因此 $au_1,...,au_m$ 必定是 $u_1,...,u_m$ 的某种排列。

将所有可逆元素乘在一起：$$au_1...au_m=u_1...u_m$$整理得$$a^{\phi(n)}=a^m \equiv (u_1...u_m)(u_1...u_m)^{-1} \equiv 1 \mod n$$类似的，欧拉定理也提供了计算逆元的另一种方式。对于 $a\in \mathbb{Z}^*_n$ ，$a^{-1}$ 可以通过计算 $a^{\phi(n)-1}$ 来得到。这跟连续平方法一样有效率，但 Euclid 算法还是更快一些（为什么？）而且也不需要计算 $\phi(n)$ 。

> 【译注】因为费马小定理是欧拉定理的特殊情况，所以此时它们具有相同的效率。但如果 $n$ 不是质数，就需要计算 $\phi(n)$ 了，通常都需要质因数分解，非常困难。相比之下，Euclid 算法计算逆元是一种更直接的，因为它不需要事先计算 $\phi(n)$ 的值，不涉及对 $n$ 进行因式分解。因此，对于计算逆元，特别是当 $n$ 是一个大素数时，欧几里得算法通常会比使用欧拉定理更快速。

这些定理并未告诉我们给定可逆元素 $a \in \mathbb{Z}^*_n$ 的阶数，但是它们缩小了其范围：令 $x$ 是 $a$ 的阶。如果已知 $a^y \equiv 1 \mod n$ ，由 [[Euclid 算法]] 我们可以找到一组 $m,n$ 使得$$d=mx+ny$$其中 $d=\gcd(x,y)$ 。于是$$a^d=a^{mx+ny}=(a^x)^m(a^y)^n \equiv 1 \mod n$$因此，由于 $d \le x$，必有 $d=x$ （因为 $x$ 是使得 $a^x \equiv 1 \mod n$ 成立最小正整数），于是 $x$ 必定是 $y$ 的因子。因此由欧拉定理，$a$ 的阶整除 $\phi(n)$ 。

这些定理是 [[循环群|群论中拉格朗日定理]] 的特殊情况。（费马和欧拉远在群论被发现之前就去世了。）

# 乘积与阶

设 $x$ 是 $a \in \mathbb{Z}^*_n$ 的阶，$y$ 是 $b \in \mathbb{Z}^*_n$ 的阶。那么 $ab$ 的阶是多少？

假设 $(ab)^k \equiv 1 \mod n$ 。左右两侧都做 $x$ 次幂得$$1 \equiv (ab)^{kx} = (a^x)^k b^{kx} \equiv 1^k b^{kx}=b^{kx} \mod n$$由于 $b$ 的阶是 $y$ ，可以看出 $y|kx$ （ $y$ 整除 $kx$ ）。

假设 $x,y$ 互质。则必有 $y|k$ 。类似的 $x|k$ ，因此 $k$ 必须是 $xy$ 的倍数。另一方面，我们有 $(ab)^{xy} \equiv 1 \mod n$ 。因此 $ab$ 的阶就是 $xy$ ，即对于那些有互质阶的元素，它们乘积的阶等于它们阶数的乘积。

更一般的，令 $d=\gcd(x,y)$。由 $x|ky$ 以及 $y|kx$ 意味着 $k$ 必定是 $(x/d)(y/d)$ 的倍数。如果 $z$ 是 $x,y$ 的最小公倍数，可由 $z=xy/d$ 得出，则 $(ab)^z \equiv 1 \mod n$ 。至此，我们可以说 $ab$ 的阶是 $xy/d^2$ 的倍数，且能被 $xy/d$ 整除。

# RSA 问题

如果我们已知正整数  $e,N$ 和 $a^e \mod N$ ，其中 $a$ 是某个可逆元素。我们如何求出 $a$ 来？

一个策略是找到一个整数 $d$ 满足 $a^{de} \equiv a \mod N$ 。如果对于某个 $k$ 有 $de=k\phi(N)+1$，由欧拉定理，$d$ 会满足方程。换句话说，我们通过计算$$d\equiv e^{-1} \mod \phi(N)$$并计算 $(a^e)^d$ 来找出 $a$ 。

然而不对 $N$ 因式分解就不知道怎么求出 $\phi(N)$ ，而且对于很大的数也不知道如何有效的进行因式分解。
