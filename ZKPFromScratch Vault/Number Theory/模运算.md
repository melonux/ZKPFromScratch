
设 $n$ 是正整数，并将集合 $[0..n -1]$ 记作 $\mathbb{Z}_n$ 。

如果两个整数 $x,y$ 之差是 $n$ 的整数倍，我们就将它们视为“相同”，记作 $x=y \mod n$，读作 $x,y$ 模 $n$ 同余。在不会引起混淆时，我们也会省略 $\mod n$ 记号。每一个整数 $x$ 都会跟某个 $y \in \mathbb{Z}_n$ 同余。当我们通过对 $x$ 加减 $n$ 的整数倍来得到某个 $y \in \mathbb{Z}_n$ 时，称 *化简* $x \mod n$ 后的剩余是 $y$ 。

 $\mathbb{Z}_n$ 可以对应于许多不同的集合，比如对其中每个元素都加 $n$ ，但我们默认选取 $[0..n-1]$ 这个特定的集合，其中的元素称为 *最小剩余*。

**例**：$38=3 \mod 5$ 因为 $38=7 \times 5 + 3$ 。$-3=11 \mod 14$ 因为 $-3=(-1) \times 14 + 11$ 。

对于 $\mathbb{Z}_n$ 里的元素，怎样进行算术运算才是最自然的呢？给定两个元素 $x,y \in \mathbb{Z}_n$ ，可以像整数那样，对他们进行加、减、乘法运算，其结果会跟 $\mathbb{Z}_n$ 中的某个元素同余。

**例**: $6+7=1 \mod 12,\;3 \times 20 = 10 \mod 50,\; 12 - 14 = 16 \mod 18$ 。

这些运算跟常规的运算很相似。然而这里没有大小的概念。比如称 $0 < 4 \mod 8$ 是没有意义的，因为对两侧都加 $4$ 就会得到 $4 < 0 \mod 8$ 。常规的整数可被视为排列在数轴上，靠左的整数比靠右的小。然而，模 $n$ 的整数是排列在圆圈上的，比如模12对应于时钟表盘。

# 除法

上述讨论中，都没提及除法。如果 $y$ 能整除 $x$ ，有些人可能会采用常规的除法定义。让我们看看这会带来什么。比如 $10=4 \mod 6$ ，两边都除以 $2$ 会得到错误的等式 $5=2 \mod 6$ 。

因此我们必须改变常规除法的含义。直觉上，除法应该视为乘法的"逆运算"，也就是说，$x$ 除以 $y$ 的意思是找到一个数 $z$ 使得 $yz = x$ 。上面的问题在于，在 $\mathbb{Z}_n$ 中有两个不同的元素 $5$ 和 $2$，它们在乘以 $2$ 后都得到 $4$ 。

应该选取 $5$ 或 $2$ 中的哪一个作为 $4/2$ 的结果呢？我们可以任意的约定，比如选择最小的那个作为答案，但这会使得除法变得很奇怪。

相反的，我们会要求唯一性。也就是仅当存在唯一的 $z \in \mathbb{Z}_n$ 使得 $x=yz$ 时，$x$ 除以 $y$ 模 $n$ 这个运算才有定义。

我们可以通过下述方法获得除数 $y$ 应该满足的条件。假设存在两个不同的 $z$ 值：$z_1,z_2 \in \mathbb{Z}_n$ ，满足 $y z_1 = y z_2 \mod n$ 。由定义可知，存在整数 $k$ 使得 $y(z_1 - z_2)=kn$ 。令 $d=\gcd(n,y)$ ，则 $n/d$ 必然整除 $z_1-z_2$ ，因为它不能整除 $y$ 。

> 【译注】$d$ 是 $n,y$ 的最大公约数，所以 $n/d$ 是扣除公约数后剩下的差异化因子，它必定无法整除 $y$ 了，否则 $n/d$ 也应是公因子的成分才对。

于是当且仅当 $z_1=z_2 \mod n/d$ 时，有 $y z_1=y z_2 \mod n$ 。所以仅当  $d=\gcd(y,n)=1$ 时，才能保证存在唯一的 $z \in \mathbb{Z}_n$ 。

> 【译注】因为 $n/d$ 必然整除 $z_1-z_2$ ，由模的定义可知 $z_1-z_2=0 \mod n/d$ ，也就是 $z_1=z_2 \mod n/d$ 。为了保证模除法结果存在且唯一，就必须让 $d=1$ 。否则哪怕 $n,y$ 只有小小的公因子 $2$，也可以找到 $z_2=z_1+n/d \in \mathbb{Z}_n$ 或 $z_2=z_1-n/d \in \mathbb{Z}_n$ ，$z_1 \ne z_2$ 。

# 逆元

我们将看到当且仅当可以找到一个 $w \in \mathbb{Z}_n$ 满足 $yw=1 \mod n$ 时，$z$ [存在且唯一](https://crypto.stanford.edu/pbc/notes/numbertheory/division.html)。如果 $w$ 存在，它就必定唯一：假设 $yw'$ 也等于 $1$，两侧都乘 $w$ 得 $wyw=wyw'$ 。由于 $wy=1$ 所以 $w=w'$ 。当它存在时，我们称这个唯一的 $w$ 叫 $y$ 的 *逆元* ，记作 $y^{-1}$ 。

我们如何知道 $y^{-1}$ 存在？如果存在，又如何找到它呢？既然 $\mathbb{Z}_n$ 中只有 $n$ 个元素，我们可以尝试用每个元素去乘以 $y$，看结果是不是 $1$。如果都不行，则 $y$ 没有逆元。从某种意义上来说，模运算比整数运算简单。因为只涉及有限个元素，所以你总是可以通过遍历每种可能来找到答案。

现在我们有了具有良好定义的模除法：$x$ 除以 $y$ 就是 $x$ 乘以 $y^{-1}$ 如果 $y$ 存在逆元，否则这个除法无定义。

为了避免跟整数除法混淆，许多作者会在模运算中完全弃用 $/$ 符号，当他们需要表示 $x$ 除以 $y$ 时，会写成 $xy^{-1}$ 。还有一些数论教程开篇就引入逆元，用逆元定义除法而不讨论它跟整数除法的关系，这也是弃用 $/$ 的原因之一。我们也将遵循这个传统，把 $/$ 符号留给整数除法使用。

**例**：$2 \times 3+4 (5^{-1}) = 2 \mod 6$ 。





